name: Deploy Website

permissions:
  contents: write

on:
  push:
    branches:
      - main
    paths:
      - .github/**
      - website/**

jobs:
  # Build the project to ensure it works. Also to get the binaries.
  build-microzig:
    uses: ./.github/workflows/build-base.yml
    with:
      zig-version: 0.13.0
      get-submodules: true
      github-artifact-name: website-build
      artifact-output-paths: zig-out
  # Publish microzig
  publish-microzig:
    uses: ./.github/workflows/publish-base.yml
    needs: build-microzig
    concurrency:
      group: publish
      cancel-in-progress: false
    with:
      artifact-name: website
      github-artifact-name: website-build
      source-path: /
    secrets:
      target-path: ${{ secrets.DEPLOY_WS_ROOT_DATA_PATH }}
      ssh-key: ${{ secrets.DEPLOY_WS_PRIVATE_KEY }}
      host: ${{ secrets.DEPLOY_WS_HOST }}
      port: ${{ secrets.DEPLOY_WS_PORT }}
      user: ${{ secrets.DEPLOY_WS_USER }}
